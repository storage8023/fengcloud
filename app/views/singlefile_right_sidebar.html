<div class="single_file">
    <div ng-show="fileLoaded && sidebarLoaded">
        <div ng-show="!fileExist">
            <filter-right-sidebar></filter-right-sidebar>
        </div>
        <div ng-show="fileExist">
            <div class="file_info_wrapper">
                <div class="section_title">
                    <span class="name">{{file.filename}}</span>
                    <span class="title">
                        详细
                    </span>
                </div>
                <section class="scrollbar" gk-guider='{
                  buttons: [{name: "下一步",onclick:GKGuiders.next}],
                  description: "添加“注释”和“图形标记”，可以更方便地归整文件，搜索也更快速",
                  id: "guide_4",
                  next: "guide_5",
                  position: 9,
                  title: "注释和标记",
                  width: 280
                  }'>
                    <div class="file_icon">
                        <img ng-if="['jpg','jpeg','png','gif'].indexOf(file.ext)<0"
                             ng-src="{{file.filename | getFileThumb:file.dir:(file.open||(PAGE_CONFIG.file.sharepath?1:0)):file.sync}}"/>
                        <img ng-if="['jpg','jpeg','png','gif'].indexOf(file.ext)>=0"
                             error-src="{{file.filename | getFileThumb:file.dir:(file.open||(PAGE_CONFIG.file.sharepath?1:0)):file.sync}}"
                             ng-src="{{file.hash | getThumbUrl:file.filehash}}"/>
                    </div>
                    <div class="file_attrs">
                        <div class="file_name">
                            <span title="{{file.filename}}">{{file.filename}}</span>
                        </div>
                        <div title="创建人：{{file.creator_member_name}}">创建人：<span ng-bind="file.creator_member_name"></span></div>
                        <div class="smart">
                            <a href="javascript:void(0)" ng-repeat="smart in smarts"
                               ng-class="isSmartAdd(file.favorite,smart.filter)?'active':''"
                               ng-click="toggleSmart(smart.filter,file.favorite)">
                                <i class="icon16x16 {{smart.icon}}" title="{{smart.name}}"></i>
                            </a>
                        </div>
                    </div>
                    <div class="opt_wrapper" ng-show="showTab">
                        <button class="btn btn-opt" ng-show="file.dir==0" ng-click="publishFile(file)">临时链接</button>
                        <button class="btn btn-opt" ng-click="startChat(file)">发起讨论</button>
                    </div>
                    <div class="tags">
                        <div ng-if="!showTab">
                            {{file.tag}}
                        </div>
                        <textarea ng-if="showTab" size-adjust focus-me="focusPostTextarea" ng-blur="postTag(file.tag)" maxlength="280" ng-keydown="handlePostKeyDown($event,file.tag)" class="form-control" placeholder="+添加注释" ng-model="file.tag"></textarea>
                    </div>
                </section>

            </div>
            <section class="file_detail_wrapper" ng-show="showTab" gk-guider='{
                  buttons: [{name: "下一步",onclick:GKGuiders.next}],
                  description: "云库中的其他成员对协作编辑的文件进行讨论。并可以查看文件修改的历史版本",
                  id: "guide_5",
                  next: "guide_6",
                  position: 9,
                  title: "讨论和历史",
                  width: 280
                  }'>
                <div class="section_title">
                    <button class="btn btn-opt" ng-show="localFile.dir==0" ng-click="showMilestoneDialog(file)">里程碑</button>
                    <span>历史</span>
                </div>
                <div class="history_wrapper" ng-class="!histories.length || localFile.dir==1?'nocheckbox':''">
                    <div class="empty" ng-if="!histories || !histories.length">没有历史</div>
                    <ul class="scrollbar history_list" gk-version-contextmenu="localFile.dir==0" gk-version-contextmenu="localFile.dir==0">
                        <li class="c_f_after {{'act_'+history.act}}" title="{{history.property.message}}" ng-class="history.property.milestone?'milestone':''" ng-repeat="history in histories | filter:historyFilter" data-version="{{history.property.version}}">
                            <div class="act_name">
                                <div class="avatar_wrapper">
                                    <avatar class="avatar avatar_mini" gk-src="{{history.member_id|getAvatarUrl}}"></avatar>
                                </div>
                            </div>
                            <div class="act_info">
                                <div class="filename_wrapper">
                                    <span class="version_index" ng-if="history.property && history.property.index_version>0">V{{history.property.index_version}}</span>
                                    <span class="name_size_wrapper">
                                    <span class="filename" title="{{history.fullpath|baseName}}">{{history.fullpath|baseName}}</span>
                                       &nbsp;
                                    <span class="version_size" title="{{history.dir==1?'&nbsp;':(history.property.filesize|bitSize)}}">{{history.dir==1?'&nbsp;':(history.property.filesize|bitSize)}}</span>
                                    </span>
                                </div>
                                <div class="other_info">
                                    <span class="act_dateline" title="{{history.dateline*1000 | date:'yyyy/MM/dd HH:mm'}}">{{history.dateline*1000 | dateAgo}}</span>
                                    <span class="act_member" title="{{history.member_name}}">{{history.member_name}}</span>
                                    <span class="act">{{history.act_name}}</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <div class="checkbox_wrapper" ng-show="histories.length && localFile.dir==0"><input class="input_checkbox" id="only_show_milestone" type="checkbox" ng-model="onlyShowMileStone" /><label for="only_show_milestone">只显示里程碑</label></div>
                </div>
            </section>
        </div>
    </div>
    <div class="empty loading" ng-show="!fileLoaded || !sidebarLoaded">正在加载...</div>
</div>